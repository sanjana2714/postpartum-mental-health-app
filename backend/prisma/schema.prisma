// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum Role {
  USER
  ADMIN
  PROVIDER
}

enum Language {
  ENGLISH
  HINDI
  TELUGU
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Stage {
  PREGNANT
  POSTPARTUM
}

enum MoodLevel {
  VERY_HAPPY
  HAPPY
  NEUTRAL
  SAD
  VERY_SAD
}

enum QuestionnaireType {
  EPDS
  GAD7
  PSS
}

enum RiskLevel {
  LOW
  MEDIUM
  HIGH
}

enum ContentCategory {
  ARTICLE
  VIDEO
  PODCAST
}

enum ContentType {
  INFORMATION
  ENTERTAINMENT
}

enum PartnerStatus {
  ACTIVE
  INACTIVE
}

// Models
model User {
  id                    Int                      @id @default(autoincrement())
  email                 String                   @unique
  phone                 String?
  password              String
  role                  Role                     @default(USER)
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  userProfile           UserProfile?
  moodCheckins          MoodCheckin[]
  questionnaireResponses QuestionnaireResponse[]
  alerts                Alert[]
  bookmarks             Bookmark[]
  chatMessages          ChatMessage[]
  userBadges            UserBadge[]
  providerLinks         PatientProviderLink[]
  medications           Medication[]
  partners              Partner[]
  notificationSettings  NotificationSetting[]
  communityPosts        CommunityPost[]
}

model UserProfile {
  id              Int       @id @default(autoincrement())
  userId          Int       @unique
  name            String
  age             Int?
  gender          Gender
  language        Language  @default(ENGLISH)
  stage           Stage
  deliveryDate    DateTime?
  weeksPostpartum String?
  profilePhoto    String?
  partnerContact  String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MoodCheckin {
  id           Int       @id @default(autoincrement())
  userId       Int
  moodLevel    MoodLevel
  notes        String?
  checkinDate  DateTime  @default(now())
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, checkinDate])
}

model QuestionnaireResponse {
  id          Int                @id @default(autoincrement())
  userId      Int
  type        QuestionnaireType
  score       Int
  responses   Json
  createdAt   DateTime           @default(now())
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type, createdAt])
}

model ChatMessage {
  id        Int      @id @default(autoincrement())
  userId    Int
  content   String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Alert {
  id        Int      @id @default(autoincrement())
  userId    Int
  message   String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model Content {
  id              Int              @id @default(autoincrement())
  title           String
  category        ContentCategory
  type            ContentType
  createdAt       DateTime         @default(now())
}

model Bookmark {
  id        Int      @id @default(autoincrement())
  userId    Int
  contentId Int
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

model CommunityTopic {
  id          Int      @id @default(autoincrement())
  title       String
  posts       CommunityPost[]
}

model CommunityPost {
  id            Int      @id @default(autoincrement())
  userId        Int
  topicId       Int
  content       String
  createdAt     DateTime @default(now())
  user          User     @relation(fields: [userId], references: [id])
  topic         CommunityTopic @relation(fields: [topicId], references: [id])
}

model Badge {
  id        Int      @id @default(autoincrement())
  name      String
  users     UserBadge[]
}

model UserBadge {
  id        Int      @id @default(autoincrement())
  userId    Int
  badgeId   Int
  grantedAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
  badge     Badge    @relation(fields: [badgeId], references: [id])
}

model Provider {
  id             Int                   @id @default(autoincrement())
  name           String
  patientLinks   PatientProviderLink[]
}

model PatientProviderLink {
  id         Int     @id @default(autoincrement())
  patientId  Int
  providerId Int
  createdAt  DateTime @default(now())
  user       User     @relation(fields: [patientId], references: [id])
  provider   Provider  @relation(fields: [providerId], references: [id])
}

model NotificationSetting {
  id          Int      @id @default(autoincrement())
  userId      Int
  notificationType String
  isEnabled   Boolean  @default(true)
  user        User     @relation(fields: [userId], references: [id])
}

model Medication {
  id        Int      @id @default(autoincrement())
  userId    Int
  name      String
  dosage    String
  frequency String
  user      User     @relation(fields: [userId], references: [id])
}

model Partner {
  id        Int      @id @default(autoincrement())
  userId    Int
  status    PartnerStatus
  user      User     @relation(fields: [userId], references: [id])
}